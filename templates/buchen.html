<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Tennisplatz buchen</title>
</head>
<body>

<header>
    <img src="logo.png" alt="Logo">
    <h1>Tennisplatz-Buchungssystem</h1>
</header>

<main class="form-container">

    <h2>Tennisplatz buchen</h2>
    {% if fehler %}
        <p style="color:red">{{ fehler }}</p>
    {% endif %}

    <form method="POST" action="{{ url_for('buchen') }}">

        <!-- Personalien -->
        <h3>Personalien</h3>

        <label>Nutzer-ID (optional)</label>
        <input type="number" name="nid" id="nid" placeholder="Bestehende Nutzer-ID" value="{{ nutzer.nid if nutzer else '' }}">

        <label>Vorname</label>
        <input type="text" name="vorname" id="vorname" value="{{ nutzer.vorname if nutzer else '' }}" required>

        <label>Nachname</label>
        <input type="text" name="nachname" id="nachname" value="{{ nutzer.nachname if nutzer else '' }}" required>

        <label>Geburtsdatum</label>
        <input type="date" name="geburtsdatum" id="geburtsdatum" value="{{ nutzer.geburtsdatum if nutzer else '' }}">

        <label>E-Mail</label>
        <input type="email" name="email" id="email" value="{{ nutzer.email if nutzer else '' }}" required>

        <!-- Buchungsdetails -->
        <h3>Buchungsdetails</h3>

        <label>Tennisanlage</label>
        <select name="tennisanlage" id="tennisanlage" required>
            <option value="">-- bitte wählen --</option>
            {% for a in anlagen %}
                <option value="{{ a }}">{{ a }}</option>
            {% endfor %}
        </select>

        <label>Platznummer</label>
        <select name="platznummer" id="platznummer" required>
            <option value="">-- bitte wählen --</option>
            {% for p in plaetze %}
                <option value="{{ p.platznummer }}">{{ p.platznummer }} ({{ p.tennisanlage }})</option>
            {% endfor %}
        </select>

        <label>Spieldatum</label>
        <input type="date" name="spieldatum" required>

        <label>Spielbeginn</label>
        <input type="time" name="beginn" required>

        <label>Spielende</label>
        <input type="time" name="ende" required>

        <button type="submit">Buchung bestätigen</button>
    </form>
</main>

<footer>
    <p>
        Impressum<br>
        Tennisverein Musterstadt · Musterstraße 1 · 12345 Musterstadt
    </p>
</footer>

<!-- JS für automatische Feldausfüllung bei Nutzer-ID -->
<script>
document.getElementById("nid").addEventListener("blur", function() {
    let nid = this.value;
    if (!nid) return;

    fetch(`/get_nutzer/${nid}`)
    .then(response => response.json())
    .then(data => {
        document.getElementById("vorname").value = data.vorname || "";
        document.getElementById("nachname").value = data.nachname || "";
        document.getElementById("geburtsdatum").value = data.geburtsdatum || "";
        document.getElementById("email").value = data.email || "";
    });
});
</script>

</body>
</html>